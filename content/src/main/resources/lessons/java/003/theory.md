# Урок 3. Условия, циклы и методы: управляющая логика автотестов

## Зачем это в AQA

Автотест почти всегда — это набор **ветвлений** и **повторяющихся проверок**:

- если статус ответа не 2xx → падаем с понятным сообщением;
- пока элемент не найден → повторяем попытку;
- для каждого объекта из API → выполняем одинаковые проверки;
- повторяющуюся логику выносим в методы, чтобы не копировать код.

---

## Базовые определения

- **Условный оператор (`if/else`)** — конструкция, которая выполняет блок кода только при истинности условия.
- **Цикл** — повторение блока кода, пока выполняется условие или пока не пройдены элементы коллекции.
- **Итерация** — один проход цикла.
- **Метод** — именованный блок кода, который можно вызывать многократно.
- **Off-by-one ошибка** — неверная граница цикла (`<=` вместо `<`), из-за чего пропускается/дублируется элемент.

---

## 1) `if/else` и логические операторы

```java
int status = 404;
if (status >= 200 && status < 300) {
    System.out.println("OK");
} else {
    System.out.println("FAIL: " + status);
}
```

Полезные операторы:
- `&&` — И (оба условия true)
- `||` — ИЛИ (достаточно одного true)
- `!` — НЕ (инверсия)

### Частые ошибки

1. Перепутали `&&` и `||`.
2. Использовали слишком сложное условие в одной строке.
3. Не вынесли проверку в отдельный метод (получается «лапша»).

---

## 2) Циклы в практических проверках

### `for`

Используйте, когда нужен индекс:

```java
for (int i = 0; i < users.size(); i++) {
    System.out.println(i + ": " + users.get(i));
}
```

### `for-each`

Используйте, когда индекс не нужен:

```java
for (String role : roles) {
    if (role.isBlank()) {
        System.out.println("Пустая роль");
    }
}
```

### `while`

Подходит для повторных попыток (retry):

```java
int attempts = 0;
while (attempts < 5 && !ready) {
    attempts++;
    // повторный запрос/ожидание
}
```

---

## 3) `break` и `continue`

- `break` — выйти из цикла полностью.
- `continue` — пропустить текущую итерацию и перейти к следующей.

```java
for (int code : statuses) {
    if (code == 204) continue;       // пропускаем
    if (code >= 500) break;          // критическая ошибка — выходим
    System.out.println(code);
}
```

---

## 4) Методы и переиспользуемость

В тестах полезно выносить общие проверки в методы:

```java
static boolean isSuccessStatus(int status) {
    return status >= 200 && status < 300;
}

static void assertSuccessStatus(int status) {
    if (!isSuccessStatus(status)) {
        throw new AssertionError("Ожидался 2xx, но пришёл " + status);
    }
}
```

Плюсы:
- меньше дублирования;
- проще поддержка;
- единый формат сообщений об ошибках.

---

## 5) Чеклист перед коммитом теста

1. Границы циклов корректны (`i < size`, а не `i <= size`).
2. Условия читаемы и покрывают edge cases.
3. Повторяющийся код вынесен в методы.
4. Сообщения об ошибках информативны (что ожидалось/что получено).

Эти практики делают автотесты стабильнее и упрощают отладку в CI.
