# Kotlin Beginner 1. Переменные, типы данных и null-безопасность

## Зачем этот урок AQA-инженеру

В автотестах мы постоянно:
- сохраняем значения из ответов API и UI,
- сравниваем `actual` и `expected`,
- передаём данные между шагами,
- работаем с полями, которые иногда приходят `null`.

Kotlin помогает делать это безопасно и читаемо: вы сразу видите, где значение может быть пустым, а где нет.

---

## `val` и `var`: что выбирать и почему

- `val` — ссылка не меняется после инициализации (предпочтительный вариант для тестов).
- `var` — значение можно переопределить (используем только там, где действительно нужна мутация).

```kotlin
val userId: Long = 123L
var retries: Int = 0

retries += 1
// userId = 555L // Ошибка компиляции: val нельзя переопределить.
```

### Практическое правило

В тестах старайтесь начинать с `val`. Если компилятор «заставляет» перейти на `var`, значит переменная реально изменяется — это нормальный сигнал, а не неудобство.

---

## Базовые типы, которые чаще всего нужны в AQA

- `String` — тексты, id в строковом формате, сообщения ошибок.
- `Int`/`Long` — статусы, счётчики, timestamp/id.
- `Boolean` — флаги проверок.
- `Double`/`BigDecimal` — деньги и дробные значения (`BigDecimal` надёжнее для финансов).

```kotlin
val statusCode: Int = 200
val requestId: String = "REQ-101"
val isSuccess: Boolean = statusCode in 200..299
```

---

## Null-safety: ключевая идея Kotlin

В Kotlin типы бывают:
- **не-nullable**: `String` (не может быть `null`),
- **nullable**: `String?` (может быть `null`).

Это критично для тестов: API может вернуть неполные данные, и язык заранее заставляет вас это обработать.

```kotlin
val email: String? = response.email
val login: String = "test.user"
```

Если попробовать использовать `email` как обычную строку без проверки, компилятор остановит вас.

---

## Операторы `?.`, `?:`, `!!` — что это и когда применять

### 1) Безопасный вызов `?.`

Выполнит операцию только если объект не `null`.

```kotlin
val normalizedEmail: String? = email?.trim()?.lowercase()
```

### 2) Elvis-оператор `?:`

Возвращает значение справа, если слева `null`.

```kotlin
val emailForAssert: String = email?.trim() ?: ""
```

### 3) `!!` (not-null assertion)

Принудительно говорит «здесь точно не null». Если вы ошиблись — получите `NullPointerException`.

```kotlin
val definitelyEmail: String = email!! // Использовать крайне осторожно.
```

**Рекомендация:** в автотестах предпочтительнее `?.` и `?:`, а `!!` — только когда логика действительно гарантирует non-null.

---

## Сравнение значений: `==` и `===`

- `==` — сравнение **значений** (то, что обычно нужно в тестах).
- `===` — сравнение **ссылок** (тот же объект в памяти).

```kotlin
val expected = "OK"
val actual: String? = response.status

val sameValue = expected == actual
```

Для большинства assert-проверок используйте именно сравнение по значению.

---

## Мини-пример из автотеста

```kotlin
val expectedStatus = "ACTIVE"
val actualStatus: String? = userResponse.status

val isStatusCorrect = expectedStatus == (actualStatus?.trim() ?: "")
println("STATUS_CHECK=$isStatusCorrect")
```

Здесь мы сразу закрываем частый edge-case: статус может быть `null` или с лишними пробелами.

## Домашнее задание

Только тестирование:
- квиз по `val/var`, базовым типам и `null`.
